name: data-house-ci

on:
  pull_request:
    branches:
    - main
    paths:
      - "dbmodel/**"
      - "deploy/**"
      - ".github/workflows/**"

jobs:
  local-docker-build:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout the data-house repository
        id: checkout-repo
        uses: actions/checkout@v4
        
      -
        name: build the dbdeploy dockerfile
        id: build-dockerfile
        run: docker build --file deploy/dbdeploy.Dockerfile --tag dbdeploy .

      -
        name: build the database model
        run: docker run dbdeploy dotnet new sqlproj -s Sql150 --name dbmodel && dotnet build ./dbmodel/dbmodel.csproj  
        id: build-dbmodel

      -
        name: run the TSQL linter
        run: docker run dbdeploy tsqllint --print-config
        id: run-linter
